import{s as r}from"./dashboards-BQYUHD6Z.js";import"./vendor-BLPh2XG4.js";import"./ui-Dc2VBgM7.js";import"./supabase-wzm6nDUs.js";async function e(e){const s=async e=>await r.from("reviews").insert([e]).select().single(),t={...e,user_id:null};try{const{error:r,data:e}=await s(t);if(r){const e=r.message||r.msg||JSON.stringify(r),i=Array.from(e.matchAll(/'([a-zA-Z0-9_]+)'/g)).map(r=>r[1]);for(const r of i)if(r in t){const{[r]:e,...i}=t;return await s(i)}if(e.toLowerCase().includes("permission")||e.toLowerCase().includes("policy")){const{user_id:r,salon_id:e,...i}=t;return await s(i)}if(e.toLowerCase().includes("violates foreign key constraint")||/_fkey\b/.test(e)){const r=e.toLowerCase();if(r.includes("user_id")||r.includes("reviews_user_id_fkey")){const{user_id:r,...e}=t;return await s(e)}if(r.includes("salon_id")||r.includes("reviews_salon_id_fkey")){const{salon_id:r,...e}=t;return await s(e)}if("user_id"in t){const{user_id:r,...e}=t,i=await s(e);if(!i.error)return i}if("salon_id"in t){const{salon_id:r,...e}=t;return await s(e)}}return{error:r}}return{error:null,data:e}}catch(i){const e=i&&(i.message||i.msg||JSON.stringify(i))||"",s=Array.from(e.matchAll(/'([a-zA-Z0-9_]+)'/g)).map(r=>r[1]);for(const o of s)if(o in t){const{[o]:e,...s}=t;try{const{error:e,data:t}=await r.from("reviews").insert([s]).select().single();return{error:e,data:t}}catch(n){return{error:n}}}if(e.toLowerCase().includes("violates foreign key constraint")||/_fkey\b/.test(e)){const s=e.toLowerCase();if(s.includes("user_id")||s.includes("reviews_user_id_fkey")){const{user_id:e,...s}=t;try{const{error:e,data:t}=await r.from("reviews").insert([s]).select().single();return{error:e,data:t}}catch(o){return{error:o}}}if(s.includes("salon_id")||s.includes("reviews_salon_id_fkey")){const{salon_id:e,...s}=t;try{const{error:e,data:t}=await r.from("reviews").insert([s]).select().single();return{error:e,data:t}}catch(a){return{error:a}}}if("user_id"in t){const{user_id:e,...s}=t;try{const{error:e,data:t}=await r.from("reviews").insert([s]).select().single();if(!e)return{error:null,data:t}}catch(c){}}if("salon_id"in t){const{salon_id:e,...s}=t;try{const{error:e,data:t}=await r.from("reviews").insert([s]).select().single();return{error:e,data:t}}catch(d){return{error:d}}}}if(e.toLowerCase().includes("permission")||e.toLowerCase().includes("policy")){const{user_id:e,salon_id:s,...i}=t;try{const{error:e,data:s}=await r.from("reviews").insert([i]).select().single();return{error:e,data:s}}catch(l){return{error:l}}}return{error:i}}}export{e as insertReviewSafe};
