import{s as e}from"./dashboards-BQYUHD6Z.js";import"./vendor-BLPh2XG4.js";import"./ui-Dc2VBgM7.js";import"./supabase-wzm6nDUs.js";async function t(t){try{const r=t.salon_id;if(r){let{data:a}=await e.from("salons").select("id, lead_time_hours").eq("id",r).maybeSingle();if(!a){a=(await e.from("salons").select("id, lead_time_hours").eq("slug",r).maybeSingle()).data}if(a){const e=Number(a.lead_time_hours||0);if(e>0&&t.date&&t.time){const r=String(t.time).split(":").map(e=>Number(e)),[a=0,n=0]=r,[i,s,o]=String(t.date).split("-").map(Number),m=new Date(i,(s||1)-1,o||1,a,n||0,0),c=new Date((new Date).getTime()+60*e*60*1e3);if(m.getTime()<c.getTime())return{error:{message:`Salon vereist minimaal ${e} uur van tevoren boeken`}}}}}}catch(a){}const r=async t=>{const r={...t};return r.time&&"string"==typeof r.time&&(r.time=r.time),await e.from("appointments").insert([r])};try{const{error:e,data:a}=await r(t);if(e){const a=e.message||e.msg||JSON.stringify(e);if(a.includes("Could not find the 'service_name'")||a.includes("service_name")){const{service_name:e,serviceName:a,...n}=t;return await r(n)}const n=a.match(/Could not find the '([a-zA-Z0-9_]+)' column/);if(n){const e=n[1],{[e]:a,...i}=t;return await r(i)}return{error:e}}return{error:null,data:a}}catch(n){const r=n&&(n.message||n.msg||JSON.stringify(n))||"";if(r.includes("Could not find the 'service_name'")||r.includes("service_name")){const{service_name:r,serviceName:a,...n}=t;try{const{error:t,data:r}=await e.from("appointments").insert([n]);return{error:t,data:r}}catch(i){return{error:i}}}const a=r.match(/Could not find the '([a-zA-Z0-9_]+)' column/);if(a){const r=a[1],{[r]:n,...i}=t;try{const{error:t,data:r}=await e.from("appointments").insert([i]);return{error:t,data:r}}catch(s){return{error:s}}}return{error:n}}}export{t as insertAppointmentSafe};
