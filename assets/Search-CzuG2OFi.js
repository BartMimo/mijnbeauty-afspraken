import{u as e,j as s,I as a,B as t,C as l,a as n,s as i}from"./dashboards-BzIxZDf7.js";import{u as r,f as o,r as d}from"./vendor-BLPh2XG4.js";import{L as c,M as m,H as u}from"./ui-Dc2VBgM7.js";import"./supabase-wzm6nDUs.js";const x=[{value:"Kapper",label:"Kapsalon"},{value:"Nagels",label:"Nagelsalon"},{value:"Wimpers",label:"Wimper & Brow Studio"},{value:"Massage",label:"Massagesalon"},{value:"Gezichtsbehandeling",label:"Gezichtssalon"},{value:"Huidverzorging",label:"Huidverzorging"},{value:"Make-up",label:"Make-up Salon"},{value:"Overig",label:"Overig"}],h=(e,s,a,t)=>{const l=(a-e)*Math.PI/180,n=(t-s)*Math.PI/180,i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},v=()=>{const{user:v}=e(),g=r(),[p]=o(),[j,f]=d.useState(p.get("q")??""),[b,N]=d.useState("all"),[w,y]=d.useState(""),[k,M]=d.useState(null),[C,S]=d.useState(10),[z,I]=d.useState(!1),[_,L]=d.useState([]),[P,q]=d.useState(!0),[B,F]=d.useState(new Set),[Z,$]=d.useState(1);d.useEffect(()=>{let e=!0;return async function(){q(!0);const{data:s,error:a}=await i.from("salons").select("*, services(id,name), categories").eq("status","active");e&&!a&&(L((s??[]).map(e=>{let s=e.city??"";if(!s&&e.address){const a=e.address.split(",");if(a.length>=2){const e=a[a.length-1].trim(),t=e.match(/^(\d{4}\s*\w{2})\s+(.+)$/);s=t?t[2]:e}}return{id:e.slug??e.id,salonId:e.id,slug:e.slug,name:e.name,city:s,address:e.address??"",zipCode:e.zip_code??"",latitude:e.latitude,longitude:e.longitude,description:e.description??"",image:e.image_url??e.image??"https://images.unsplash.com/photo-1560066984-138dadb4c035?w=800",rating:e.rating??4.5,reviewCount:e.review_count??0,categories:e.categories??[],services:(e.services??[]).map(e=>({id:e.id,name:e.name}))}})),q(!1),await(async()=>{if(v)try{const{data:e,error:s}=await i.from("favorites").select("salon_id").eq("user_id",v.id);if(s)return;F(new Set(e.map(e=>e.salon_id)))}catch(e){}else F(new Set)})())}(),()=>{e=!1}},[v]);const A=d.useMemo(()=>{const e=j.toLowerCase().trim();return _.filter(s=>{var a,t;const l=!e||s.name.toLowerCase().includes(e)||(null==(a=s.services)?void 0:a.some(s=>s.name.toLowerCase().includes(e))),n="all"===b||(null==(t=s.categories)?void 0:t.includes(b)),i=!k||!s.latitude||!s.longitude||h(k.lat,k.lng,s.latitude,s.longitude)<=C;return l&&n&&i})},[_,j,b,k,C]),G=async()=>{if(!w.trim())return M(null),void $(1);I(!0);try{const e=await(async e=>{try{const s=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e+", Netherlands")}&limit=1`),a=await s.json();if(a.length>0)return{lat:parseFloat(a[0].lat),lng:parseFloat(a[0].lon)}}catch(s){}return null})(w.trim());e?(M(e),$(1)):alert("Adres niet gevonden. Probeer een ander adres.")}catch(e){alert("Fout bij het zoeken van het adres. Probeer het opnieuw.")}finally{I(!1)}},H=A.length,K=Math.max(1,Math.ceil(H/20)),E=d.useMemo(()=>A.slice(20*(Z-1),20*Z),[A,Z]);return s.jsxs("div",{className:"container mx-auto px-4 py-6",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[s.jsx(a,{placeholder:"Zoek salon of behandeling",value:j,onChange:e=>{f(e.target.value),$(1)}}),s.jsx(t,{onClick:()=>$(1),children:"Zoek"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsxs(l,{className:"p-6 sticky top-6",children:[s.jsx("h3",{className:"font-bold text-lg mb-4",children:"Filters"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Type salon"}),s.jsxs("select",{value:b,onChange:e=>{N(e.target.value),$(1)},className:"w-full h-11 rounded-xl border border-stone-200 px-3",children:[s.jsx("option",{value:"all",children:"Alle types salons"}),x.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]}),s.jsxs("div",{className:"pt-4 border-t border-stone-200",children:[s.jsx("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Zoek op locatie"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx(a,{placeholder:"Bijv. Amsterdam, Utrecht...",value:w,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&G(),className:"flex-1"}),s.jsx(t,{onClick:G,disabled:z,size:"sm",children:z?s.jsx(c,{size:16,className:"animate-spin"}):"Zoek"})]}),k&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"text-xs text-green-600 font-medium",children:"✓ Locatie gevonden"}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:["Zoekradius: ",C," km"]}),s.jsx("input",{type:"range",min:"1",max:"50",value:C,onChange:e=>{S(Number(e.target.value)),$(1)},className:"w-full h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer slider"}),s.jsxs("div",{className:"flex justify-between text-xs text-stone-500 mt-1",children:[s.jsx("span",{children:"1 km"}),s.jsx("span",{children:"50 km"})]})]}),s.jsx(t,{variant:"outline",size:"sm",onClick:()=>{M(null),y(""),$(1)},className:"w-full",children:"Locatie wissen"})]})]})]}),s.jsx("div",{className:"pt-4 border-t border-stone-200",children:s.jsx(t,{variant:"outline",onClick:()=>{f(""),N("all"),M(null),y(""),S(10),$(1)},className:"w-full",children:"Reset filters"})})]})]})}),s.jsxs("div",{className:"lg:col-span-3",children:[s.jsxs("div",{className:"mb-4 flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"font-bold text-xl",children:P?"Laden…":`${H} salons gevonden`}),k&&s.jsxs("p",{className:"text-sm text-stone-500 mt-1",children:["Binnen ",C," km van ",w]})]}),s.jsxs("span",{className:"text-sm text-stone-500",children:["Pagina ",Z," van ",K]})]}),P?s.jsx("div",{className:"flex justify-center py-12",children:s.jsx(c,{className:"animate-spin"})}):0===E.length?s.jsx(l,{className:"p-8 text-center",children:"Geen salons gevonden."}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:E.map(e=>{var a,r;return s.jsxs(l,{className:"flex flex-col",children:[s.jsx("div",{className:"h-40 overflow-hidden",children:s.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover"})}),s.jsxs("div",{className:"p-4 flex-1 flex flex-col justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"flex justify-between items-start mb-2",children:s.jsx("h3",{className:"font-bold text-lg",children:e.name})}),s.jsxs("p",{className:"text-sm text-stone-500",children:[s.jsx(m,{size:14,className:"inline mr-1"}),e.city||(e.address?null==(a=e.address.split(",")[e.address.split(",").length-1])?void 0:a.trim():"Locatie onbekend"),k&&e.latitude&&e.longitude&&s.jsxs("span",{className:"ml-2 text-blue-600",children:["• ",h(k.lat,k.lng,e.latitude,e.longitude).toFixed(1)," km"]})]}),s.jsx("p",{className:"text-sm mt-2 line-clamp-2 text-stone-600",children:e.description}),s.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:null==(r=e.services)?void 0:r.slice(0,3).map(e=>s.jsx(n,{children:e.name},e.id))})]}),s.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[s.jsxs("span",{className:"text-sm text-stone-600",children:[e.rating," ★ • ",e.reviewCount," reviews"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(t,{onClick:()=>g(`/salon/${e.id}`),children:"Bekijk"}),s.jsx("button",{onClick:s=>{s.stopPropagation(),(async e=>{if(!v)return void alert("Log in om salons toe te voegen aan je favorieten");const s=B.has(e),a=new Set(B);try{s?(await i.from("favorites").delete().eq("user_id",v.id).eq("salon_id",e),a.delete(e)):(await i.from("favorites").insert({user_id:v.id,salon_id:e}),a.add(e)),F(a)}catch(t){}})(e.salonId)},className:"p-2 rounded-full transition-colors "+(B.has(e.salonId)?"bg-red-100 text-red-600 hover:bg-red-200":"bg-stone-100 text-stone-400 hover:bg-stone-200 hover:text-stone-600"),children:s.jsx(u,{className:B.has(e.salonId)?"fill-current":"",size:16})})]})]})]})]},e.id)})}),s.jsxs("div",{className:"mt-6 flex justify-center gap-2",children:[s.jsx(t,{variant:"outline",disabled:1===Z,onClick:()=>$(e=>Math.max(1,e-1)),children:"Vorige"}),s.jsxs("span",{className:"text-sm",children:[Z,"/",K]}),s.jsx(t,{variant:"outline",disabled:Z===K,onClick:()=>$(e=>Math.min(K,e+1)),children:"Volgende"})]})]})]})]})};export{v as SearchPage};
